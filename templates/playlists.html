<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Playlists</title>
	<link rel="stylesheet" href="/static/styles.css"> 
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
</head>
<body>
    <h1>Playlists</h1>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    
    <!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
    Crear nueva playlist
  </button>
  
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Crear Playlist Nueva</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form onsubmit="crear_playlist(event)">
        <div class="modal-body">
        
          <p><label>Nombre: </label><input name="nombre"></input></p>
          <p><label>Selecciona un libro: </label><select id="opciones_libros"name="opciones_libros">
            <script>
                function handle_response(data){
                    if(!data){
                        alert('Error al cargar libros')
                        window.location.href=`http://127.0.0.1:5000/`
                    }else{
                        const select=document.getElementById('opciones_libros')
                        for (var i = 0; i < data.libros.length; i++){
                            const opcion = document.createElement('option')
                            opcion.innerText= data.libros[i].nombre
                            opcion.setAttribute('value',data.libros[i].id)
                            select.appendChild(opcion)
                        } 
                    }

                }
                fetch(`http://127.0.0.1:5000/catalogo/todos`)
			    .then((res)=>res.json())
			    .then(handle_response)
			    .catch((error)=> console.log('ERROR',error))
            </script>
          </select></p>
        

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Save changes</button>
        </div>
        </form>
      </div>
    </div>
  </div>

<!------------------------------------->
 
<!-- Button trigger modal -->

<!---
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal2">
    Agregar libro a playlist
  </button>
  
--->
 
  <!-- Modal -->
  <div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel2">Agregar un libro a una playlist</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
       
        <form onsubmit="agregar_libro(event,get_nombre_playlist('exampleModal2') )">
        <div class="modal-body">
            
          <p><label>Selecciona un libro para agregar a la playlist "<label id="titulo_playlist_1"></label>":
            
            </label><select id="opciones_libros_2"name="opciones_libros_2">
            <script>
                function handle_response_select_agregar_libro(data){
                    if(!data){
                        alert('Error al cargar libros')
                        window.location.href=`http://127.0.0.1:5000/`
                    }else{
                        const select=document.getElementById('opciones_libros_2')
                        for (var i = 0; i < data.libros.length; i++){
                            const opcion = document.createElement('option')
                            opcion.innerText= data.libros[i].nombre
                            opcion.setAttribute('value',data.libros[i].id)
                            select.appendChild(opcion)
                        } 
                    }

                }
                fetch(`http://127.0.0.1:5000/catalogo/todos`)
			    .then((res)=>res.json())
			    .then(handle_response_select_agregar_libro)
			    .catch((error)=> console.log('ERROR',error))
            </script>
          </select></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Save changes</button>
        </div>
        </form>
      </div>
    </div>
  </div>


<!----------------->
<!-- Button trigger modal -->
<!--
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal3">
    Remover libro de playlist
  </button>
  
--> 

  <!-- Modal -->
  <div class="modal fade" id="exampleModal3" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel3">Remover un libro  una playlist</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form onsubmit="remover_libro(event,get_nombre_playlist('exampleModal3'))">

        <div class="modal-body">
        
          <p><label>Selecciona un libro a remover de la playlist "<label id="titulo_playlist_2">":</label></label>
            <select id="opciones_playlist_3"name="opciones_playlist_3"></select></p>
        

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Save changes</button>
        </div>
        </form>
      </div>
    </div>
  </div>



    {% endfor %}

    </ul>

<script>
        function handle_response_crear_playlist(data){
            if(data){
                window.location.href=`http://127.0.0.1:5000/playlists`
            }else{alert('Error al crear playlist')}
        }

        function crear_playlist(event){
            event.preventDefault()
            const formData = new FormData(event.target)
			const nombre = formData.get("nombre")
            console.log(nombre)
			const id_libro = formData.get("opciones_libros")
            console.log(id_libro)
            fetch(`http://127.0.0.1:5000/playlists`,{
				method: "POST",
				headers: {
					"Content-Type":"application/json"
				},body:JSON.stringify({
					id_libro:id_libro,
					nombre:nombre
					})	
			})
			.then((res)=>res.json())
			.then(handle_response_crear_playlist)
			.catch((error)=> console.log("ERROR",error))
		}

    </script>

</body>
</html>
